# 가상의 장애 대응 문서

## 목차

- 장애 요약
- 장애 탐지 시간
- 영향받은 서비스 / 기능
- 영향 대상
- 장애 원인
- 타임라인
- 해결 과정
- 재발 방지 대책

---

## 장애 요약

- 장애 발생 시점: 09:01 (쿠폰 오픈 시간인 09:00 직후)
- 장애 내용: 쿠폰 발급 API( [POST] localhost:3000/api/coupons/{couponId}/issued ) 호출 시 정상적으로 쿠폰이 발급되지 않음
- 주 원인: Redis 다운으로 인해 쿠폰 재고 및 대기열 정보를 조회할 수 없어 쿠폰 발급이 정상 처리되지 않음

---

## 장애 탐지 시간

- 탐지 시간: 09:01
- 쿠폰 오픈 시간인 09:00 이후 대기 중이던 다수의 사용자가 쿠폰 발급을 시도했고, 에러 발생 로그가 급증함에 따라 09:01에 장애로 판별하였음

---

## 영향받은 서비스 / 기능

- 쿠폰 발급 기능:
    - Redis에서 관리하는 쿠폰 재고/대기열 정보를 정상적으로 조회할 수 없어서 발급 요청이 실패하거나 지연되는 현상 발생

---

## 영향 대상

- 전체 사용자 중 쿠폰 발급을 시도한 사용자:
    - 장애 발생 시간(09:01)부터 Redis가 복구될 때까지 쿠폰 발급이 불가능

---

## 장애 원인

- Redis 서버가 단일 인스턴스로 구성되어 있었음
- 장애 시점에 Redis 인스턴스가 다운되어 쿠폰 발급 로직에 필요한 재고 및 대기열 정보 조회가 불가

---

## 타임라인

1. 09:00
    - 쿠폰 오픈 시간. 대규모 사용자 유입으로 발급 트래픽 급증
2. 09:01
    - 쿠폰 발급 실패 로그 폭증 → 모니터링 시스템에서 에러 알림 발생, 장애 인지
3. 09:05
    - 장애 원인 파악 착수: Redis 다운 상태 확인
4. 09:10
    - Redis 프로세스 재시작 시도 (1차 조치)
5. 09:15
    - Redis 정상 구동 확인, 서비스 점검 진행
6. 09:20
    - 쿠폰 발급 트래픽 점검 및 정상 동작 확인, 모니터링 강화
7. 09:30
    - 장애 보고 및 재발 방지 논의

---

## 해결 과정

1. Redis 서버 상태 확인: 서버 로그에서 Redis 프로세스 비정상 종료 확인
2. 프로세스 재기동 시도: Redis 인스턴스를 재시작하여 메모리 및 프로세스 정상화 진행
3. 서비스 재확인:
    - Redis 재시작 후 쿠폰 발급 API를 테스트하여 정상 응답 확인
    - 장애 기간 중 실패한 트랜잭션 로그 분석 및 보상/정정 절차 진행
4. 모니터링 지표 점검:
    - Redis CPU/메모리 사용량, 연결 상태 등을 집중 모니터링

---

## 재발 방지 대책

1. Redis 클러스터링 및 고가용성(HA) 구성
    - 단일 인스턴스 다운 시에도 즉각적인 Failover가 가능하도록 클러스터링을 도입
2. 트래픽 예측 및 사전 대응 체계 도입
    - 피크 타임 예측 모델 구축: 과거 트래픽 로그와 이벤트 일정을 기반으로 향후 트래픽 급증 구간을 사전에 식별
    - 부하 테스트 및 용량 계획 정기 시행: 예측된 최대 트래픽 양을 토대로 인프라 자원을 확장하거나 재구성
    - 실시간 스케일링/알림 시스템 연동: 예측 범위를 초과하는 트래픽 발생 시 자동 확장 혹은 담당자 알림을 통해 즉각 대응 가능

---
